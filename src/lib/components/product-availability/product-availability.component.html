<!-- ── Header with close button ──────────────────────────── -->
<div class="dialog-header">
	<button mat-icon-button (click)="close()">
		<mat-icon>arrow_back</mat-icon>
	</button>
	<h2>Store Availability</h2>
</div>

<div mat-dialog-content class="cnc-availability">
	<p class="cnc-availability__subtitle">
		Enter a location or zip code to find the nearest store with your product.
	</p>

	<mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center">
		<!-- Address tab -->
		<mat-tab label="Address">
			<div class="cnc-availability__search-row">
				<mat-form-field appearance="outline" class="cnc-availability__field">
					<mat-label>Zip code or address</mat-label>
					<input
						#searchInput
						matInput
						type="text"
						placeholder="Enter zip code or address"
					/>
				</mat-form-field>
				<button mat-icon-button type="button" (click)="useCurrentLocation()">
					<mat-icon fontSet="material-icons-outlined">my_location</mat-icon>
				</button>
			</div>

			<div class="cnc-availability__results">
				@for (nearbyStore of nearbyStores(); track nearbyStore.store.id) {
					<cnc-store-card
						[store]="nearbyStore.store"
						[selected]="pendingStore()?.id === nearbyStore.store.id"
						[stock]="nearbyStore.stock ?? null"
						[distance]="nearbyStore.distance"
						(storeSelect)="onStoreSelect($event)"
					/>
				} @empty {
					<p class="cnc-availability__empty-hint">
						Search by address or use your current location to find stores.
					</p>
				}
			</div>
		</mat-tab>

		<!-- Map tab -->
		<mat-tab label="Map">
			<cnc-maps
				[cartProducts]="cartProducts()"
				[size]="data.size ?? 0"
				[modelNo]="data.modelNo ?? ''"
				[variantId]="data.variantId ?? ''"
			/>
		</mat-tab>
	</mat-tab-group>
</div>

<!-- ── Confirm store bar ────────────────────────────────── -->
@if (pendingStore()) {
	<div class="confirm-bar">
		<button mat-flat-button class="cnc-btn" (click)="confirmStoreSelection()">
			Confirm store
		</button>
	</div>
}
