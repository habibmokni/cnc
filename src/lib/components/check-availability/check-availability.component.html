@if (!isSizeSelected()) {
	<div class="cnc-check__size-picker">
		<h2 class="cnc-check__title">Select Size</h2>
		@if (size() > 0) {
			<p class="cnc-check__subtitle">Your current size selection is: {{ size() }}</p>
		}
		@for (sizeOption of data.sizes; track sizeOption) {
			<mat-divider />
			<a class="cnc-check__size-item" (click)="changeSize(sizeOption)">{{ sizeOption }}</a>
			<mat-divider />
		}
	</div>
}

@if (isSizeSelected()) {
	<div mat-dialog-content class="cnc-check">
		<h2 class="cnc-check__title">Check Availability</h2>
		<p class="cnc-check__subtitle">
			Enter the location or zip code to check which nearest store has the selected product
		</p>

		<button mat-flat-button class="cnc-check__size-btn" (click)="isSizeSelected.set(false)">
			Size Selected: {{ size() }}
		</button>

		<mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center">
			<mat-tab label="Address">
				<div class="cnc-check__search-row">
					<mat-form-field appearance="outline" class="cnc-check__field">
						<mat-label>Zip code or address</mat-label>
						<input
							#searchInput
							matInput
							type="text"
							placeholder="Enter zip code or address"
						/>
					</mat-form-field>
					<button mat-icon-button type="button" (click)="currentLocation()">
						<mat-icon fontSet="material-icons-outlined">room</mat-icon>
					</button>
				</div>

				@for (nearbyStore of nearbyStores(); track nearbyStore.store.id) {
					<mat-divider />
					<div class="cnc-check__result">
						<div class="cnc-check__result-header">
							<h3>{{ nearbyStore.store.name }}</h3>
							<span class="cnc-check__filler"></span>
							<mat-icon fontSet="material-icons-outlined">room</mat-icon>
							<span>{{ nearbyStore.distance.toFixed(2) }} km</span>
						</div>
						<p class="cnc-check__address">{{ nearbyStore.store.address }}</p>
						@if ((nearbyStore.stock ?? 0) > 5) {
							<p class="cnc-check__stock cnc-stock--good">
								Size {{ size() }} is in good stock
							</p>
						} @else if ((nearbyStore.stock ?? 0) > 0) {
							<p class="cnc-check__stock cnc-stock--low">
								Size {{ size() }} is almost sold out
							</p>
						} @else {
							<p class="cnc-check__stock cnc-stock--out">
								Size {{ size() }} is out of stock
							</p>
						}
					</div>
					<mat-divider />
				}
			</mat-tab>

			<mat-tab label="Map">
				@if (isSizeSelected()) {
					<cnc-maps
						[size]="size()"
						[modelNo]="data.modelNo"
						[variantId]="data.variantId"
					/>
				}
			</mat-tab>
		</mat-tab-group>
	</div>
}
